<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=7, IE=9, IE=10">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>TEST</title>
    <link rel="stylesheet" href="http://js.arcgis.com/3.10/js/dojo/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://js.arcgis.com/3.10/js/esri/css/esri.css">
    <style>
        body {
            margin: 10px
        }
        .left {
            float: left;
            width: 125px;
            text-align: right;
            margin: 10px 10px;
            display: inline
        }
        .right {
            margin: 10px 10px;
        }
        #numOfRows {
            width: 40px;
        }
    </style>
    <script src="http://js.arcgis.com/3.10/"></script>

    <body>
        This sample demonstrates how to add multiple maps with linked extents. The application can be easily modified to increase or decrease the number of maps displayed in the browser.
        </hr>
        <br /><b>Connect maps</b>
        <input type='checkbox' class='list_item' id='ToggleBox' value=0 checked=true />
        </br>
        <b>How many rows would you like?</b>
        <input type="number" id="numOfRows" value=3 max="10" onkeypress="return enterPress(event)" length=2>
        <input id="executeButton" type="button" value="Go!" onclick="updateRows()" />
        </form>
        </br>
        <span id="mapSpan">
    </span>


    <script>
        var mapCount = 6;
        var mapArray = [];
        var mapDiv;
        var handle;
        var f = 0;
        var bool1 = true;
        var bool2;
        var myBox;
        var handleOver;
        var handleOut;


        require([
        "esri/map",
        "dojo/parser",
        "dojo/dom",
        "dojo/on",
        "dojo/mouse",
        "esri/layers/FeatureLayer",


        "dijit/layout/BorderContainer",
        "dijit/layout/ContentPane",

        "dojo/domReady!"
    ], function (
            Map,
            parser,
            dom,
            on,
            mouse,
            FeatureLayer
        ) {

            parser.parse();

            createMaps();
            modifyMaps();
            //setAllListners(bool1);

            //***********************************************************
            function createMaps() {
                console.log(">>>> create maps");
                for (var i = 0; i < mapCount; i++) {
                    mapArray[i] = "map" + (i);
                    var mapDiv = "map" + i + "Div";
                    mapArray[i] = new Map(mapDiv, {
                        center: [-85, 43],
                        zoom: 5,
                        basemap: "streets"
                    });
                }
            }

            //***********************************************************

        <script>
            var rows = document.getElementById("numOfRows").value;
            var mapCount = rows * 2;
            var mapArray = [];
            var lastMap = 0;
            var updated = false;


             //add a toggle to disconnect/connect the map extents
            var mapToggle = document.getElementById("ToggleBox");
            mapToggle.addEventListener('change', onMapMove);

             //create the initial divs based on the input div id=numOfRows
            updateRows();
             //create the maps and add their layers
            createMaps();
             //start the maps as connected
            onMapMove();


             //################################################################################################################################
             //################################################################################################################################

             //if enter key is pressed, update rows
            function enterPress(e) {
                e = e || event;
                var keycode = e.keyCode
                if (keycode === 13) {
                    console.log("enter");
                    updateRows();
                }
            }

             //update rows from input
            function updateRows() {
                console.log("update");
                rows = document.getElementById("numOfRows").value;
                //limit the number of rows to 15
                if (rows > 15) {
                    alert("Please choose a number less than 15.");
                } else {
                    var parent = document.getElementById("mapSpan");
                    while (parent.firstChild) {
                        parent.removeChild(parent.firstChild);
                    }
                    mapCount = rows * 2;
                    var spanInnerHtml;
                    var mapDivA;
                    var mapDivB;
                    var j = 0;
                    for (var i = 0; i < mapCount; i += 2) {
                        var spanRow = document.createElement("span");
                        spanRow.id = "row" + j;
                        var mapHtml = "<div id=\"map" + i + "\" style=\"width: 45%; height: 200px\" class=\"left\"></div><div id=\"map" + (i + 1) + "\" style=\"width: 45%; height: 200px\" class=\"right\"></div></br>";
                        spanRow.innerHTML = mapHtml;
                        parent.appendChild(spanRow);
                        j = j + 1;
                    }
                    createMaps();
                    onMapMove();
                }
            }

             //################################################################################################################################
             //################################################################################################################################

            function onMapMove() {
                //when reconnecting the maps, set extents to last modified map
                if (mapToggle.checked == true) {
                    for (var i = 0; i < mapCount; i++) {
                        mapArray[i].on('moveend', onMapMove);
                        var mapNum = lastMap;
                        //console.log(lastMap);
                        var newZoom = mapArray[mapNum].getZoom();
                        var newCenter = mapArray[mapNum].getCenter();

                        //prevent other maps from changing the extent of active map
                        for (var i = 0; i < mapCount; i++) {
                            // console.log(i);
                            mapArray[i].off('moveend', onMapMove);
                            mapArray[i].setView(newCenter, newZoom);
                        }
                    }
                    //turn mapMove listeners back on
                    for (var i = 0; i < mapCount; i++) {
                        mapArray[i].on('moveend', onMapMove);
                    }
                }
                //disconnect the maps
                else {
                    for (var i = 0; i < mapCount; i++) {
                        mapArray[i].off('moveend', onMapMove);
                    }
                }
                console.log(mapToggle.checked);
            }

             //################################################################################################################################
             //################################################################################################################################

             //***********************************************************
             //***********************************************************
            function modifyMaps() {
                console.log(">>>>>>>>>> add basemaps and layers");

                mapArray[0].on("load", function () {

                });
                ////////////////////////////////////////////////////////////////////////////////////
                mapArray[1].on("load", function () {

                    mapArray[1].setBasemap("satellite");
                    var cities = new FeatureLayer("http://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer/0");
                    mapArray[1].addLayer(cities);
                });
                ////////////////////////////////////////////////////////////////////////////////////
                mapArray[2].on("load", function () {

                    mapArray[2].setBasemap("hybrid");
                });
                ////////////////////////////////////////////////////////////////////////////////////
                mapArray[3].on("load", function () {

                    mapArray[3].setBasemap("gray");
                    var counties = new FeatureLayer("http://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer/2");
                    mapArray[3].addLayer(counties);
                });
                ////////////////////////////////////////////////////////////////////////////////////
                mapArray[4].on("load", function () {

                    mapArray[4].setBasemap("oceans");
                });
                ////////////////////////////////////////////////////////////////////////////////////
                mapArray[5].on("load", function () {

                    mapArray[5].setBasemap("national-geographic");
                });
            }
             //***********************************************************        //***********************************************************

            mapArray[0].on("load", function () {
                myBox = document.getElementById("CheckBox");
                myBox.checked = true;
                setAllListners(myBox.checked);
                on(dom.byId("CheckBox"), "change", function () {
                    setAllListners(myBox.checked);
                    console.log(myBox.checked);
                });
            });


             //find first modified map
            for (var i = 0; i < mapCount; i++) {
                mapArray[i].on('moveend', function (e) {
                    var clickedMap = e.target._container.id;
                    var mapNum = clickedMap.slice(3, 4);
                    lastMap = mapNum;
                    //console.log(mapNum);
                });
            }
            }
        </script>
    </body>

</html>



