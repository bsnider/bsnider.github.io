<!--To modify the number of maps, simply add map divs, and change the mapCount.-->
<!DOCTYPE html>
<html lang="en">

<head>
    <title>MultMaps</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <!-- Leaflet -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css">
    <!-- MapBox -->
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />


    <!-- custom -->
    <!--<link rel="stylesheet" href="/css/style.css">-->



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>
    .left {
        float: left;
        width: 125px;
        text-align: right;
        margin: 2px 10px;
        display: inline
    }
</style>

<body>
    This sample demonstrates how to add multiple maps with linked extents. The application can be easily modified to increase or decrease the number of maps displayed in the browser.
    <br />
    <br />
    <h4>Connect maps <input type='checkbox' class='list_item' id='ToggleBox' value=0 checked=true /></h4>
    <input type="text" id="numOfRows" value="6">
    <input id="execute" type="button" value="Go!" onClick="addRemove();">
    </br>
    </br>
    <div id="map0" style="width: 45%; height: 200px" class="left"></div>
    <div id="map1" style="width: 45%; height: 200px" class="right"></div>
    </br>
    <div id="map2" style="width: 45%; height: 200px" class="left"></div>
    <div id="map3" style="width: 45%; height: 200px" class="right"></div>
    </br>

    <div id="map4" style="width: 45%; height: 200px" class="left"></div>
    <div id="map5" style="width: 45%; height: 200px" class="right"></div>






    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
    <!-- Esri Leaflet -->
    <script src="http://cdn-geoweb.s3.amazonaws.com/esri-leaflet/1.0.0-rc.3/esri-leaflet.js"></script>


    <script>
        var mapCount = 2 * document.getElementById("numOfRows").value;
        var mapArray = [];
        var lastMap = 0;

         //add a toggle to disconnect/connect the map extents
        var mapToggle = document.getElementById("ToggleBox");
        mapToggle.addEventListener('change', onMapMove);

         //create the maps and add their layers
        createMaps();
         //start the maps as connected
        onMapMove();

        function onMapMove() {
            //when reconnecting the maps, set extents to last modified map
            if (mapToggle.checked == true) {
                for (var i = 0; i < mapCount; i++) {
                    mapArray[i].on('moveend', onMapMove);
                    var mapNum = lastMap;
                    console.log(lastMap);
                    var newZoom = mapArray[mapNum].getZoom();
                    var newCenter = mapArray[mapNum].getCenter();

                    //prevent other maps from changing the extent of active map
                    for (var i = 0; i < mapCount; i++) {
                        // console.log(i);
                        mapArray[i].off('moveend', onMapMove);
                        mapArray[i].setView(newCenter, newZoom);
                    }
                }
                //turn mapMove listeners back on
                for (var i = 0; i < mapCount; i++) {
                    mapArray[i].on('moveend', onMapMove);
                }
            }
            //disconnect the maps
            else {
                for (var i = 0; i < mapCount; i++) {
                    mapArray[i].off('moveend', onMapMove);
                }
            }
            console.log(mapToggle.checked);
        }

         //find last modified map
        for (var i = 0; i < mapCount; i++) {
            mapArray[i].on('moveend', function (e) {
                var clickedMap = e.target._container.id;
                var mapNum = clickedMap.slice(3, 4);
                lastMap = mapNum;
                console.log(mapNum);
            });
        }


         ///////////////////////////////////////////////////////////////////////////////////////////////////
         ///////////////////////////////////////////////////////////////////////////////////////////////////
        function createMaps() {
            console.log(">>>> create maps");
            for (var i = 0; i < mapCount; i++) {
                mapArray[i] = L.map('map' + i).setView([42.3314, -83.0458], 8);
                if (i == 0) {
                    L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
                        id: 'examples.map-i875mjb7'
                    }).addTo(mapArray[i]);
                } else if (i == 1) {
                    L.esri.basemapLayer("Gray").addTo(mapArray[i]);
                    L.tileLayer.wms("http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
                        layers: 'nexrad-n0r-900913',
                        format: 'image/png',
                        transparent: true
                    }).addTo(mapArray[i]);
                } else if (i == 2) {

                    L.esri.basemapLayer("Imagery").addTo(mapArray[i]);
                    L.tileLayer.wms("http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
                        layers: 'nexrad-n0r-900913',
                        format: 'image/png',
                        transparent: true
                    }).addTo(mapArray[i]);

                } else if (i == 3) {
                    var darkGray = new L.esri.Layers.TiledMapLayer("http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer", {
                        style: function () {
                            return {
                                color: "#70ca49",
                                weight: 2
                            };
                        }
                    }).addTo(mapArray[i]);
                    var highways = new L.esri.FeatureLayer("http://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer/1", {
                        style: function () {
                            return {
                                color: "#70ca49",
                                weight: 2
                            };
                        }
                    }).addTo(mapArray[i]);

                } else if (i == 4) {
                    L.esri.basemapLayer("NationalGeographic").addTo(mapArray[i]);
                    var basin = new L.esri.dynamicMapLayer("http://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer", {
                        style: function () {
                            return {
                                color: "blue",
                                weight: 2
                            };
                        }
                    }).addTo(mapArray[i]);

                } else if (i == 5) {
                    L.esri.basemapLayer("Topographic").addTo(mapArray[i]);
                    var cities = new L.esri.FeatureLayer("http://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer/0", {
                        style: function () {
                            return {
                                color: "blue",
                                weight: 4
                            };
                        }
                    }).addTo(mapArray[i]);
                }
            }
            //find first modified map
            for (var i = 0; i < mapCount; i++) {
                mapArray[i].on('moveend', function (e) {
                    var clickedMap = e.target._container.id;
                    var mapNum = clickedMap.slice(3, 4);
                    lastMap = mapNum;
                    console.log(mapNum);
                });
            }
        }
    </script>
</body>

</html>



